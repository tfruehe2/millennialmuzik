
<!DOCTYPE html>
    {% load static %}
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="{% static 'blog/bootstrap.min.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'blog/style.css' %}" />
    <link href="{% static 'blog/simple-sidebar.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'blog/public/font-awesome.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'blog/jquery-ui.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'blog/jquery-ui.structure.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'blog/jquery-ui.theme.min.css' %}" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="fb-root"></div>
    <script src="{% static "blog/social_media.js" %}"></script>

      {% include 'snippets/navbar.html' %}

      <div id="wrapper">
        {% include 'snippets/sidebar.html' %}

        <div id="page-content-wrapper">
          <div class="container-fluid xyz">
            <div class="row">
              <div class="col-sm-12">
                {% block title_block %}
                {% endblock %}
                <div class="body-block">
                {% block body_block %}
                {% endblock %}
                </div>
            </div>
          </div>
          </div>
        </div>
    </div>


    {% include 'snippets/playlist_modal.html' %}

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="{% static 'blog/jquery-ui.min.js' %}"></script>
      <script src="{% static 'blog/bootstrap.min.js' %}"></script>
      <script src="{% static 'blog/sidebar_menu.js' %}"></script>
      <script>

      function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          var cookie = document.cookie.split(';');
          for(var i=0; i < cookie.length; i++) {
            var cookie = $.trim(cookie[i]);
            if( cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }

          }
        }
        return cookieValue
      }
      var csrftoken = getCookie('csrftoken');

      function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
      }

      $.ajaxSetup({
        beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
          }
        }
      });
      </script>
      <script src="{% static 'blog/music_cell_buttons.js' %}"></script>

      <script>
      if ($(window).width() <= 1170) {
        $('#wrapper').addClass('toggled-2');
      } else {
        $('#wrapper').removeClass('toggled-2');
      }

      $(window).resize(function() {
        if ($(window).width() <= 1170) {
          $('#wrapper').addClass('toggled-2');
        } else {
          $('#wrapper').removeClass('toggled-2');
        }
      });

      $(".search-button").click(function(e) {
        var $this = $(this);
        $("i", this).toggleClass("fa-search fa-times");

        $this
          .closest("li")
          .prev()
          .find('form.navbar-form')
          .fadeToggle('normal');
      });

      </script>

      <script>
      $(function () {
        $('[data-toggle="tooltip"]').tooltip()
      })

      $("button.twitter-button").hover(function(e){
        e.preventDefault();
        $(this)
            .find('img')
            .prop("src", "{% static "blog/icons/Twitter_Logo_Blue.png" %}");
      },
      function(e){
        e.preventDefault();
        $(this)
            .find('img')
            .prop("src", "{% static "blog/icons/Twitter_Logo_grey.png" %}");
      });

      $("button.fb-button").click(function(){
        $this = $(this);
        FB.ui({
          method: 'share',
          display: 'popup',
          href: $this.attr('data-url'),
        }, function(response){});
      });


      $( "button.like-button" ).click(function(e) {
        e.preventDefault();
        var $this = $(this);
        $('i', this).toggleClass("fa-heart-o fa-heart");

        $.ajax({
          url: "{% url "blog:add_like" %}",
          type: 'POST',
          data: {'post_id': $this.attr('data-id')},
          success: function(json) {
            if ($this.has('span')) {
              $this.find('strong').text("  "+json.num_likes)
            }
          },
          error: function(error) {
            console.log("failed to like post");
          },
        });
      });


      </script>
      <script>
      $('.lyrics-button').click(function(e){
        e.preventDefault();
        var $this = $(this)
          $this
            .closest('div.col-sm-4')
            .find('.panel-body')
            .hide()
            .next('.text-scroller')
            .removeClass('hidden');
          $this.remove()
      });
      </script>
      {% if user.is_authenticated %}
      <script>
      $('.playlist-button').click(function(e){
        e.preventDefault();
        var name = $(this).attr('data-song-name');
        var songID = $(this).attr('data-song-id');
        $('#songName', "#playlistModal")
            .text("Song to be added: "+name);
        $('#playlistModal')
            .attr('data-song-id', songID)
            .modal('show');

      });

      $('#submitPlaylist').click(function(e) {
        console.log('clicked')
        e.preventDefault();
        var name = $("#playlistName",'#playlistForm').val()
        var description = $("#playlistDescription",'#playlistForm').val()
        var is_private = $("#is_private",'#playlistForm').is(':checked')

        $.ajax({
          url: "{% url 'blog:create_playlist' %}",
          type: "POST",
          data: { 'song_id':$("#playlistModal").attr('data-song-id'), "name":name, "description":description, "is_private":is_private},
          dataType: 'json',
          success: function(data) {
            if (data.e) {
              console.log(data.e)
              if(data.name != ""){
                  $("#playlistName",'#playlistForm').val(data.name);
                  $('#nameError', "#playlistForm").hide()
              } else {
                    $('#nameError', "#playlistForm").show()
              }
              if(data.description != ""){
                  $("#playlistDescription",'#playlistForm').val(data.description);
                  $('#descriptionError', "#playlistForm").hide()

              } else {
                  $('#descriptionError', "#playlistForm").show()
              }
            } else {
              $('#closeModal', "#playlistModal").trigger('click')
              location.reload();
            }
          },
          error: function() {
            console.log('failed to create playlist');
          }
        })

      });

      $('#addToPlaylistBtn').click(function(e) {
        e.preventDefault();
        var playlist_id = $('#playlistButtonGroup > .active', '#playlistModal').attr('data-playlist-id')
        var song_id = $("#playlistModal").attr('data-song-id')
        console.log(playlist_id)
        if (playlist_id) {
          $('#addToPlaylistError').hide()
        $.ajax({
          url: "{% url 'blog:add_to_playlist' %}",
          type: "POST",
          data: {playlist_id: $('#playlistButtonGroup > .active', '#playlistModal').attr('data-playlist-id'),
                  song_id: $("#playlistModal").attr('data-song-id')},
          success: function() {
            $('#closeModal', "#playlistModal").trigger('click')
          },
          error: function() {

          },
        });
      } else {
        $('#addToPlaylistError').show()
      }
      });


      $('#playlistModalBtnGroup').click(function(e) {
        e.preventDefault();
        if (!$(e.target).hasClass('active')) {
          $(e.target)
          .addClass('active')
          .trigger('updateModalBody')
          .siblings()
          .removeClass("active");
        }

      });


      $('#createPlaylist').on('updateModalBody', function(e) {
        console.log('create playlist clicked')
        $('#submitPlaylist')
            .text('Create Playlist')
            .removeClass('add')
            .addClass('create');
        $('#playlistList').empty()
        $('#modalForm', '#playlistModal').toggle()
        $("#submitPlaylist").toggle()
        $('#addToPlaylistBtn').hide()

      })
      $('#addToPlaylist').on('updateModalBody', function(e) {
        console.log('AddTo playlist clicked')
        $('#modalForm', '#playlistModal').hide()
        $("#submitPlaylist").hide()
        $('#addToPlaylistBtn').toggle()
        $.ajax({
          url: "{% url "blog:user_playlists" pk=user.pk %}",
          type: "GET",
          success: function(data) {
            $('#playlistList', '#playlistModal').html(data)

          },
          error: function() {
            console.log('failed to retrieve users playlists');
          }
        });
      });

      </script>

      {% endif %}
      {% block script_block %}
      {% endblock %}
  </body>
</html>
